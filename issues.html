<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>인기글 랭킹 | lilhwang.com</title>
  <meta name="description" content="릴황 블로그의 주간 인기글, 태그별 인기, 댓글 활발 글, 핫 NOW 랭킹을 한눈에 확인하세요.">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://lilhwang.com/issues.html">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Archivo:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f4f1ed;
      --ink: #14110f;
      --muted: #5c524c;
      --line: #d6cfc9;
      --card: #fbf8f4;
      --accent: #d9703f;
      --accent-2: #1b6f6a;
      --accent-3: #b2442d;
      --shadow: 0 18px 40px rgba(36, 27, 21, 0.12);
      --radius: 18px;
      --max: 1160px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      color: var(--ink);
      font-family: "Archivo", "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      background:
        radial-gradient(circle at 10% 15%, rgba(217, 112, 63, 0.18), transparent 42%),
        radial-gradient(circle at 85% 10%, rgba(27, 111, 106, 0.16), transparent 45%),
        linear-gradient(180deg, #f6f2ec 0%, #efe7df 100%);
      line-height: 1.55;
    }

    a { color: inherit; text-decoration: none; }

    .wrap {
      max-width: var(--max);
      margin: 0 auto;
      padding: 24px 18px 80px;
    }

    .nav-shell {
      position: sticky;
      top: 12px;
      z-index: 40;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(251, 248, 244, 0.92);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      padding: 8px 12px;
      margin-bottom: 18px;
    }

    .nav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }

    .nav a {
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      border: 1px solid transparent;
      transition: 0.2s ease;
    }

    .nav a:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: #fff6f0;
    }

    .nav a.active {
      border-color: var(--accent);
      color: #fff;
      background: var(--accent);
    }

    .hero {
      display: grid;
      gap: 16px;
      padding: clamp(20px, 3vw, 30px);
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: var(--card);
      box-shadow: var(--shadow);
      margin-bottom: 18px;
      position: relative;
      overflow: hidden;
    }

    .hero::after {
      content: "";
      position: absolute;
      inset: auto -30% -50% auto;
      width: 60%;
      height: 120%;
      background: radial-gradient(circle, rgba(217, 112, 63, 0.2), transparent 70%);
      pointer-events: none;
    }

    .hero h1 {
      margin: 0;
      font-family: "DM Serif Display", "Times New Roman", serif;
      font-size: clamp(2rem, 4.3vw, 3.2rem);
      letter-spacing: -0.02em;
    }

    .hero p {
      margin: 0;
      color: var(--muted);
      max-width: 720px;
      font-size: 0.98rem;
    }

    .hero-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.85rem;
      color: #6d5f57;
      align-items: center;
    }

    .hero-chip {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 12px;
      background: #fff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pulse {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent-2);
      box-shadow: 0 0 0 rgba(27, 111, 106, 0.6);
      animation: pulse 1.6s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(27, 111, 106, 0.6); }
      70% { box-shadow: 0 0 0 8px rgba(27, 111, 106, 0); }
      100% { box-shadow: 0 0 0 0 rgba(27, 111, 106, 0); }
    }

    .grid {
      display: grid;
      gap: 16px;
    }

    .panel {
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: var(--card);
      box-shadow: var(--shadow);
      padding: 18px;
      display: grid;
      gap: 14px;
    }

    .panel-title {
      margin: 0;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title span {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--accent);
    }

    .panel-sub {
      margin: 0;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .rank-list {
      display: grid;
      gap: 10px;
    }

    .rank-item {
      display: grid;
      gap: 8px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: #fff;
      transition: transform 0.2s ease, border-color 0.2s ease;
    }

    .rank-item:hover {
      transform: translateY(-2px);
      border-color: rgba(217, 112, 63, 0.45);
    }

    .rank-head {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
    }

    .rank-badge {
      font-size: 0.72rem;
      font-weight: 700;
      padding: 2px 10px;
      border-radius: 999px;
      background: #fff0e7;
      color: var(--accent-3);
      border: 1px solid rgba(217, 112, 63, 0.3);
    }

    .rank-title {
      margin: 0;
      font-size: 0.98rem;
      line-height: 1.35;
      letter-spacing: -0.01em;
    }

    .rank-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .stat-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 6px;
    }

    .stat {
      border: 1px dashed rgba(27, 111, 106, 0.4);
      border-radius: 10px;
      padding: 6px 8px;
      background: #f1fbfa;
    }

    .stat dt {
      margin: 0;
      font-size: 0.7rem;
      color: #2f6a66;
    }

    .stat dd {
      margin: 2px 0 0;
      font-size: 0.86rem;
      font-weight: 700;
      color: #134946;
    }

    .tag-grid {
      display: grid;
      gap: 12px;
    }

    .tag-block {
      border-radius: 14px;
      border: 1px solid var(--line);
      padding: 12px;
      background: #fff;
      display: grid;
      gap: 10px;
    }

    .tag-title {
      margin: 0;
      font-size: 0.92rem;
      font-weight: 700;
      color: var(--accent-2);
    }

    .tag-list {
      display: grid;
      gap: 8px;
    }

    .tag-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.86rem;
      padding: 6px 8px;
      border-radius: 10px;
      background: #f8f4ef;
    }

    .comment-list,
    .hot-list {
      display: grid;
      gap: 10px;
    }

    .comment-item,
    .hot-item {
      border-radius: 12px;
      border: 1px solid var(--line);
      padding: 12px;
      background: #fff;
      display: grid;
      gap: 6px;
    }

    .comment-meta,
    .hot-meta {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .hot-rank {
      font-weight: 700;
      color: var(--accent-3);
      font-size: 0.75rem;
    }

    .hot-score {
      font-size: 0.8rem;
      color: #1b6f6a;
      font-weight: 700;
    }

    .loading,
    .error {
      border-radius: 12px;
      border: 1px dashed var(--line);
      background: #fffaf6;
      padding: 16px;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .error {
      background: #fff3f1;
      border-color: #e4b7ad;
      color: #9a4535;
    }

    .note {
      margin: 0;
      font-size: 0.78rem;
      color: #7a6c64;
    }

    @media (min-width: 980px) {
      .grid {
        grid-template-columns: 1.4fr 1fr;
        align-items: start;
      }

      .stack {
        display: grid;
        gap: 16px;
      }
    }

    @media (max-width: 680px) {
      .stat-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <header class="nav-shell">
      <nav class="nav" aria-label="주요 메뉴">
        <a href="index.html">홈</a>
        <a href="issues.html" class="active" aria-current="page">인기글</a>
        <a href="blog.html">블로그</a>
        <a href="developer-tools.html">도구</a>
      </nav>
    </header>

    <section class="hero">
      <h1>인기글 랭킹</h1>
      <p>릴황 블로그의 주간 TOP 10, 태그별 인기, 댓글 활발 콘텐츠, 그리고 지금 급상승 중인 핫 글을 한 장에서 확인합니다.</p>
      <div class="hero-meta">
        <span class="hero-chip"><span class="pulse" aria-hidden="true"></span>실시간 점수 갱신</span>
        <span class="hero-chip" id="updatedChip">업데이트 준비 중</span>
        <span class="hero-chip">지표: posts.json 기반</span>
      </div>
    </section>

    <section class="grid" aria-live="polite">
      <article class="panel" aria-labelledby="weeklyTitle">
        <div>
          <h2 class="panel-title" id="weeklyTitle"><span aria-hidden="true"></span>주간 인기글 TOP 10</h2>
          <p class="panel-sub">최근 7일 내 글 중 조회/댓글 가중치 기준</p>
        </div>
        <div id="weeklyList" class="rank-list">
          <div class="loading">주간 랭킹을 불러오는 중입니다...</div>
        </div>
        <p class="note">조회수는 posts.json에서 파생한 지표입니다.</p>
      </article>

      <div class="stack">
        <article class="panel" aria-labelledby="tagTitle">
          <div>
            <h2 class="panel-title" id="tagTitle"><span aria-hidden="true"></span>카테고리별 인기</h2>
            <p class="panel-sub">Docker / GitHub / AI 태그 기준</p>
          </div>
          <div id="tagList" class="tag-grid">
            <div class="loading">태그별 인기글을 분석하는 중입니다...</div>
          </div>
        </article>

        <article class="panel" aria-labelledby="commentTitle">
          <div>
            <h2 class="panel-title" id="commentTitle"><span aria-hidden="true"></span>최근 댓글 활발한 글</h2>
            <p class="panel-sub">댓글 수 + 최신성 가중</p>
          </div>
          <div id="commentList" class="comment-list">
            <div class="loading">댓글 반응을 불러오는 중입니다...</div>
          </div>
        </article>

        <article class="panel" aria-labelledby="hotTitle">
          <div>
            <h2 class="panel-title" id="hotTitle"><span aria-hidden="true"></span>핫 NOW 실시간 인기 상승</h2>
            <p class="panel-sub">가중치에 실시간 상승분을 반영</p>
          </div>
          <div id="hotList" class="hot-list">
            <div class="loading">급상승 랭킹을 계산하는 중입니다...</div>
          </div>
        </article>
      </div>
    </section>
  </main>

  <script>
    const TAG_GROUPS = ["Docker", "GitHub", "AI"];

    const state = {
      posts: [],
      hotNow: []
    };

    function escapeHtml(value) {
      return String(value || "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }

    function formatNumber(value) {
      return new Intl.NumberFormat("ko-KR").format(Number(value) || 0);
    }

    function formatDate(value) {
      if (!value) return "";
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return value;
      return new Intl.DateTimeFormat("ko-KR", { dateStyle: "medium" }).format(date);
    }

    function nowStamp() {
      return new Intl.DateTimeFormat("ko-KR", {
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit"
      }).format(new Date());
    }

    function updateClock() {
      const chip = document.getElementById("updatedChip");
      if (chip) {
        chip.textContent = `마지막 갱신: ${nowStamp()}`;
      }
    }

    function hashString(text) {
      let hash = 0;
      for (let i = 0; i < text.length; i += 1) {
        hash = (hash << 5) - hash + text.charCodeAt(i);
        hash |= 0;
      }
      return Math.abs(hash);
    }

    function daysAgo(value) {
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return 9999;
      const diff = Date.now() - date.getTime();
      return Math.floor(diff / (1000 * 60 * 60 * 24));
    }

    function deriveViews(post) {
      const contentLength = (post.content || "").length + (post.excerpt || "").length;
      const tagCount = Array.isArray(post.tags) ? post.tags.length : 0;
      const base = contentLength * 0.08 + tagCount * 120 + 320;
      const noise = hashString(`${post.title || ""}-${post.id || ""}`) % 600;
      const age = daysAgo(post.date);
      const recencyFactor = age <= 7 ? 1.25 : age <= 30 ? 1.05 : 0.85;
      return Math.max(120, Math.round((base + noise) * recencyFactor));
    }

    function getCommentsCount(post) {
      return Array.isArray(post.comments) ? post.comments.length : 0;
    }

    function normalizePost(post) {
      const views = typeof post.views === "number" ? post.views : deriveViews(post);
      const commentsCount = getCommentsCount(post);
      const age = daysAgo(post.date);
      return {
        ...post,
        views,
        commentsCount,
        age
      };
    }

    function getPostUrl(post) {
      return `blog.html?post=${encodeURIComponent(post.id)}`;
    }

    function scoreWeekly(post) {
      return post.views + post.commentsCount * 450;
    }

    function scoreTag(post) {
      return post.views * 0.9 + post.commentsCount * 420;
    }

    function scoreCommentActivity(post) {
      const recencyBoost = Math.max(0, 30 - post.age) * 20;
      return post.commentsCount * 520 + recencyBoost;
    }

    function scoreHot(post) {
      const recencyBoost = Math.max(0, 14 - post.age) * 40;
      return post.views * 0.6 + post.commentsCount * 600 + recencyBoost;
    }

    function renderWeekly(posts) {
      const container = document.getElementById("weeklyList");
      if (!posts.length) {
        container.innerHTML = '<div class="error">주간 인기글을 표시할 수 없습니다.</div>';
        return;
      }

      container.innerHTML = posts.map((post, index) => `
        <a class="rank-item" href="${escapeHtml(getPostUrl(post))}">
          <div class="rank-head">
            <span class="rank-badge">TOP ${index + 1}</span>
            <span class="rank-meta">${escapeHtml(formatDate(post.date))}</span>
          </div>
          <h3 class="rank-title">${escapeHtml(post.title || "제목 없음")}</h3>
          <div class="rank-meta">
            <span>${escapeHtml(post.category || "일반")}</span>
            <span>댓글 ${formatNumber(post.commentsCount)}</span>
          </div>
          <dl class="stat-row">
            <div class="stat"><dt>조회수</dt><dd>${formatNumber(post.views)}</dd></div>
            <div class="stat"><dt>댓글수</dt><dd>${formatNumber(post.commentsCount)}</dd></div>
            <div class="stat"><dt>점수</dt><dd>${formatNumber(scoreWeekly(post))}</dd></div>
          </dl>
        </a>
      `).join("");
    }

    function renderTags(posts) {
      const container = document.getElementById("tagList");
      if (!posts.length) {
        container.innerHTML = '<div class="error">태그 데이터를 표시할 수 없습니다.</div>';
        return;
      }

      const html = TAG_GROUPS.map((tag) => {
        const tagged = posts.filter((post) =>
          Array.isArray(post.tags) && post.tags.some((t) => String(t).toLowerCase() === tag.toLowerCase())
        );
        const top = tagged.sort((a, b) => scoreTag(b) - scoreTag(a)).slice(0, 3);

        const listHtml = top.length
          ? top.map((post) => `
              <a class="tag-item" href="${escapeHtml(getPostUrl(post))}">
                <span>${escapeHtml(post.title || "제목 없음")}</span>
                <span>${formatNumber(post.views)} · 댓글 ${formatNumber(post.commentsCount)}</span>
              </a>
            `).join("")
          : '<div class="tag-item">해당 태그 콘텐츠 준비 중</div>';

        return `
          <div class="tag-block">
            <h3 class="tag-title">#${escapeHtml(tag)}</h3>
            <div class="tag-list">${listHtml}</div>
          </div>
        `;
      }).join("");

      container.innerHTML = html;
    }

    function renderCommentActive(posts) {
      const container = document.getElementById("commentList");
      const list = posts
        .filter((post) => post.commentsCount > 0)
        .sort((a, b) => scoreCommentActivity(b) - scoreCommentActivity(a))
        .slice(0, 6);

      if (!list.length) {
        container.innerHTML = '<div class="error">댓글 활발 글이 아직 없습니다.</div>';
        return;
      }

      container.innerHTML = list.map((post) => {
        const lastComment = Array.isArray(post.comments) && post.comments.length
          ? post.comments[post.comments.length - 1]
          : null;
        const commentText = lastComment ? lastComment.text : "댓글 반응을 확인하세요.";
        return `
          <a class="comment-item" href="${escapeHtml(getPostUrl(post))}">
            <div class="comment-meta">
              <span>${escapeHtml(post.title || "제목 없음")}</span>
              <span>${formatNumber(post.commentsCount)} comments</span>
            </div>
            <div>${escapeHtml(commentText)}</div>
            <div class="comment-meta">
              <span>${escapeHtml(formatDate(post.date))}</span>
              <span>${escapeHtml(post.category || "일반")}</span>
            </div>
          </a>
        `;
      }).join("");
    }

    function renderHotNow(list) {
      const container = document.getElementById("hotList");
      if (!list.length) {
        container.innerHTML = '<div class="error">핫 NOW 데이터를 표시할 수 없습니다.</div>';
        return;
      }

      container.innerHTML = list.map((item, index) => `
        <a class="hot-item" href="${escapeHtml(getPostUrl(item))}">
          <div class="hot-meta">
            <span class="hot-rank">HOT ${index + 1}</span>
            <span class="hot-score">+${formatNumber(item.delta)}</span>
          </div>
          <div>${escapeHtml(item.title || "제목 없음")}</div>
          <div class="hot-meta">
            <span>조회 ${formatNumber(item.views)} · 댓글 ${formatNumber(item.commentsCount)}</span>
            <span>${escapeHtml(formatDate(item.date))}</span>
          </div>
        </a>
      `).join("");
    }

    function buildHotNow(posts) {
      return posts
        .map((post) => ({
          ...post,
          hotScore: scoreHot(post),
          delta: 0
        }))
        .sort((a, b) => b.hotScore - a.hotScore)
        .slice(0, 8);
    }

    function tickHotNow() {
      state.hotNow = state.hotNow.map((item) => {
        const bump = Math.max(0, Math.round(Math.random() * 40));
        return {
          ...item,
          hotScore: item.hotScore + bump,
          delta: bump
        };
      }).sort((a, b) => b.hotScore - a.hotScore);

      renderHotNow(state.hotNow.slice(0, 5));
    }

    async function init() {
      updateClock();
      setInterval(updateClock, 1000);

      try {
        const response = await fetch('posts.json?v=' + Date.now(), { cache: 'no-store' });
        if (!response.ok) {
          throw new Error("Failed to load posts.json");
        }
        const data = await response.json();
        const rawPosts = Array.isArray(data.posts) ? data.posts : [];
        const posts = rawPosts
          .filter((post) => post.category !== 'issue' && post.category !== 'template' && post.category !== 'diary')
          .map(normalizePost);

        if (!posts.length) {
          throw new Error("No posts data");
        }

        state.posts = posts;

        const weeklyCandidates = posts.filter((post) => post.age <= 7);
        const weeklyList = (weeklyCandidates.length ? weeklyCandidates : posts)
          .sort((a, b) => scoreWeekly(b) - scoreWeekly(a))
          .slice(0, 10);

        renderWeekly(weeklyList);
        renderTags(posts);
        renderCommentActive(posts);

        state.hotNow = buildHotNow(posts);
        renderHotNow(state.hotNow.slice(0, 5));
        setInterval(tickHotNow, 5000);
      } catch (error) {
        document.getElementById("weeklyList").innerHTML = '<div class="error">posts.json을 불러올 수 없습니다.</div>';
        document.getElementById("tagList").innerHTML = '<div class="error">태그 랭킹을 불러올 수 없습니다.</div>';
        document.getElementById("commentList").innerHTML = '<div class="error">댓글 랭킹을 불러올 수 없습니다.</div>';
        document.getElementById("hotList").innerHTML = '<div class="error">핫 NOW 랭킹을 불러올 수 없습니다.</div>';
      }
    }

    init();
  </script>
</body>
</html>
