# 클라우드 비용 최적화 실전 가이드: 작은 스타트업도 80% 이상 절약하는 방법

## 개요
클우드 컴퓨팅은 현대 소프트웨어 개발의 필수 요소가 되었지만, 많은 기업이 예상보다 훨씬 높은 비용에 당황하고 있습니다. 특히 이벤트 기반 아키텍처를 사용하는 경우, 초기에는 저렴해 보이지만 트래픽이 증가하면서 예상치 못한 비용 폭탄을 맞게 됩니다. 이 글에서는 실제로 검증된 비용 절감 전략들을 소개합니다.

## 1. 토픽 파티션 수와 인스턴스 크기의 관계 이해하기

많은 기업이 Kafka나 MSK(Amazon Managed Streaming for Kafka)를 사용하면서 간과하는 중요한 사실이 있습니다. 바로 토픽-파티션 수가 브로커 인스턴스 크기에 직접적인 영향을 준다는 점입니다.

### 왜 이게 문제가 될까요?

- **데이터 양은 일정한데** 토픽만 늘어나도 브로커 업그레이드가 필요합니다
- 토픽이 100개에서 1000개로 늘어나도, 실제 데이터 처리량은 변함없을 수 있습니다
- 하지만 MSK는 파티션 수에 따라 더 큰 VM을 요구합니다
- 결과: 데이터는 그대로인데 비용만 3-4배로 증가하는荒謬한 상황 발생

### 해결책

1. **파티션 합치기 전략**: 비슷한 목적의 토픽을 하나로 통합
2. ** retention 정책 최적화**: 불필요하게 오래 데이터를 보관하지 않기
3. **메시지 크기 조절**: 작은 메시지 여러 개보다 적절히 큰 메시지로 배치 처리

## 2. VPC 피어링의 숨은 비용 함정

멀티 계정/멀티 VPC 환경은 보안과 격리 측면에서 좋지만, 데이터 전송 비용이 예상 밖으로 발생합니다.

### 발생하는 비용들

- **VPC 피어링 설정 비용**: 물론 물론 물리는 없지만, 유지보수 인걘이 발생
- **AZ(가용영역) 간 데이터 전송**: 프로듀서가 AZ-A에 있고, 브로커가 AZ-B에 있다면? 비용 발생!
- **Cross-region 트래픽**: 리전 간 데이터 이동은 정말 비쌉니다
- **Read amplification**: 한 메시지를 4개의 컨슈머가 읽으면 4배의 네트워크 비용

### 실제 계산 예시

한 달에 10TB 데이터를 처리하는 시스템이라면:
- 데이터 자체 저장: 약 $230 (EBS)
- AZ 간 전송 (4x amplification): 약 $368
- **총 네트워크 비용이 저장 비용의 1.6배!**

## 3. 오브젝트 스토리지를 활용한 새로운 아키텍처

기존 메시지 브로커를 완전히 대체하는 대신, 하이브리드 접근법이 있습니다. S3 같은 오브젝트 스토리지를 메시지 저장소로 활용하는 것입니다.

### 아키텍처 개요

```
[Producer] → [Agent Group A] → [S3 Bucket] ← [Agent Group B] ← [Consumer]
                (VPC-A)            (Shared)          (VPC-B)
```

### 장점

1. **네트워크 비용 제로**: VPC 피어링이나 AZ 간 전송 없음
2. **무제한 스케일**: 토픽 수와 관계없이 저장 가능
3. **지리적 유연성**: S3는 리전 간 자동 복제 가능
4. **비용 효율**: S3는 GB당 $0.023로 매우 저렴

### 단점과 극복 방법

- **지연 시간**: 실시간성이 떨어질 수 있음 → "Hot data"는 기존 브로커에, "Cold data"는 S3로
- **복잡성**: 에이전트 그룹 관리 필요 → 오픈소스 솔루션 활용 (Benthos, Vector 등)

## 4. 캐싱 전략으로 API 비용 절감

클우드 API 호출 비용도 무시할 수 없습니다. 특히 외부 API를 많이 사용하는 서비스라면 캐싱은 필수입니다.

### 캐싱 계층 설계

1. **L1 - 인메모리 캐시**: Caffeine, Guava Cache (서버 낮)
2. **L2 - 로컬 디스크**: RocksDB, LevelDB (서버 재시작 후에도 유지)
3. **L3 - 분산 캐시**: Redis, Memcached (서버 간 공유)

### 캐시 키 설계 원칙

- **시간 기반 TTL**: 데이터 변경 주기에 맞춰 설정
- **LRU 정책**: 메모리 부족 시 자동 제거
- **태그 기반 무효화**: 관련 데이터 일괄 삭제

## 5. Auto-scaling의 진짜 비용

Auto-scaling은 유용하지만, 잘못 설정하면 오히려 비용을 증가시킬 수 있습니다.

### 흔한 실수

- **너무 민감한 스케일 아웃**: 1분간 CPU 70%만 되어도 인스턴스 추가
- **너무 느린 스케일 인**: 트래픽 감소 후에도 한 시간 동안 인스턴스 유지
- **온디맨드 인스턴스만 사용**: 스팟 인스턴스 활용 안 함

### 올바른 설정 방법

1. **Target Tracking Policy**: CPU 50% 목표로 설정
2. **Cooldown Period**: 스케일 아웃 후 5분, 스케일 인 후 15분 설정
3. **Mixed Instances**: 온디맨드 30% + 스팟 70% 조합

## 실제 절감 사례 요약

위 전략들을 종합적으로 적용한 결과:

| 항목 | 기존 | 최적화 후 | 절감률 |
|------|------|----------|--------|
| 메시지 브로커 | $60,000/년 | $8,000/년 | 87% |
| 네트워크 전송 | $15,000/년 | $2,000/년 | 87% |
| 스토리지 | $8,000/년 | $3,000/년 | 63% |
| **총계** | **$83,000/년** | **$13,000/년** | **84%** |

## 마무리

클우드 비용 최적화는 "한 번하고 끝"이 아닙니다. 지속적인 모니터링과 개선이 필요합니다. 다음 사항들을 체크리스트로 활용하세요:

- [ ] 매월 비용 보고서 검토
- [ ] 미사용 리소스 정리 (오래된 스냅샷, 미연결 EBS 등)
- [ ] 예약 인스턴스 구매 검토 (1년 이상 사용 예정 시)
- [ ] 스팟 인스턴스 활용 가능 여부 확인
- [ ] 데이터 전송 비용 모니터링

작은 규모라도 이런 최적화를 미리 항상하면, 나중에 큰 비용 부담 없이 자연스럽게 스케일업할 수 있습니다.

---

*이 글은 2026년 2월 15일에 작성되었습니다. 클라우드 서비스 가격은 변경될 수 있으니 실제 적용 시 최신 정보를 확인하세요.*
